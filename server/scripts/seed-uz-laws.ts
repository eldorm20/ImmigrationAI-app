import { db } from "../db";
import { researchArticles } from "../../shared/schema";
import { logger } from "../lib/logger";

const UZ_LAWS = [
    {
        title: "Закон РУз № ЗРУ-692 «О правовом положении иностранных граждан и лиц без гражданства в Республике Узбекистан»",
        slug: "zru-692",
        summary: "Определяет правовой статус, права и обязанности иностранных граждан и лиц без гражданства в Узбекистане.",
        body: `Закон РУз № ЗРУ-692 от 04.06.2021 является основополагающим документом, регулирующим пребывание иностранцев.

Основные положения:
1. Иностранные граждане имеют те же права и обязанности, что и граждане Узбекистана, за некоторыми исключениями (право голоса, работа в госорганах).
2. Основанием для пребывания являются визы или вид на жительство.
3. Иностранцы обязаны соблюдать Конституцию и законы Республики Узбекистан.

Полный текст доступен на lex.uz: https://lex.uz/docs/5443901`,
        category: "regulations",
        type: "regulation",
        language: "ru",
        tags: ["Узбекистан", "ЗРУ-692", "Правовой статус"],
        source: "Lex.uz",
        sourceUrl: "https://lex.uz/docs/5443901"
    },
    {
        title: "Закон РУз № ЗРУ-610 «О гражданстве Республики Узбекистан»",
        slug: "zru-610",
        summary: "Регулирует вопросы приобретения, восстановления и прекращения гражданства Республики Узбекистан.",
        body: `Закон определяет условия приема в гражданство:
- Общий порядок (ст. 19): Требуется постоянное проживание (вид на жительство) в течение 5 лет непрерывно.
- Упрощенный порядок (ст. 20): Для лиц, состоящих в браке с гражданином Узбекистана (после 3 лет брака и проживания).

Основные изменения 2020 года включают упрощение процедур для соотечественников.

Полный текст: https://lex.uz/docs/4765373`,
        category: "visa",
        type: "regulation",
        language: "ru",
        tags: ["Гражданство", "ЗРУ-610", "Узбекистан"],
        source: "Lex.uz",
        sourceUrl: "https://lex.uz/docs/4765373"
    },
    {
        title: "Постановление КабМина № 408 «О порядке въезда, выезда, пребывания и транзитного проезда иностранных граждан»",
        slug: "pkm-408",
        summary: "Основной регламент процедур регистрации, получения виз и правил пребывания иностранцев.",
        body: `ПКМ № 408 (с изменениями) регулирует:
1. Порядок оформления въездных виз.
2. Правила регистрации по месту пребывания.
3. Ответственность за нарушение правил пребывания.

Иностранцы обязаны зарегистрироваться в течение 3 рабочих дней со дня въезда (через E-mehmon или органы внутренних дел).

Источник: https://lex.uz/docs/513096`,
        category: "regulations",
        type: "regulation",
        language: "ru",
        tags: ["Регистрация", "Визы", "ПКМ-408"],
        source: "Lex.uz",
        sourceUrl: "https://lex.uz/docs/513096"
    },
    {
        title: "Закон РУз № ЗРУ-1074 от 10.07.2025 «О регистрации по месту жительства и месту пребывания»",
        slug: "zru-1074-registration",
        summary: "Новейшее обновление правил регистрации в Узбекистане, вступившее в силу в июле 2025 года.",
        body: `ЗРУ-1074 систематизирует и цифровизирует процессы регистрации:
- Срок регистрации для иностранцев: 3 рабочих дня.
- Срок регистрации для граждан при смене жительства: 10 рабочих дней.
- Внедрение систем E-mehmon (отели) и E-xabar berish (частный сектор).
- Штрафы за нарушение правил пребывания: от 5 до 25 БРВ.

Это обновление делает процесс регистрации преимущественно уведомительным.

Источник: https://lex.uz/docs/7627933`,
        category: "regulations",
        type: "regulation",
        language: "ru",
        tags: ["Регистрация", "2025", "ЗРУ-1074"],
        source: "Lex.uz",
        sourceUrl: "https://lex.uz/docs/7627933"
    }
];

async function seedLaws() {
    try {
        console.log("Seeding Uzbekistan laws into research articles...");

        for (const law of UZ_LAWS) {
            await db.insert(researchArticles).values({
                ...law,
                category: law.category as any,
                type: law.type as any,
                isPublished: true,
                publishedAt: new Date(),
                createdAt: new Date(),
                updatedAt: new Date()
            } as any).onConflictDoUpdate({
                target: researchArticles.slug,
                set: {
                    title: law.title,
                    summary: law.summary,
                    body: law.body,
                    updatedAt: new Date()
                }
            });
            console.log(`Seeded/Updated law: ${law.slug}`);
        }

        console.log("Seeding complete.");
        process.exit(0);
    } catch (error) {
        console.error("Failed to seed laws:", error);
        process.exit(1);
    }
}

seedLaws();
